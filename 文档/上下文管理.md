## é¡¹ç›®ä¸Šä¸‹æ–‡ç®¡ç†æŠ€æœ¯ï¼ˆContext Management Deep Diveï¼‰

### æ‘˜è¦
æœ¬é¡¹ç›®å°†â€œä¸Šä¸‹æ–‡â€è§†ä¸ºè´¯ç©¿å¤š Agent åä½œå…¨æµç¨‹çš„ç¬¬ä¸€ç±»å…¬æ°‘ã€‚ä¸Šä¸‹æ–‡ä¸ä»…åŒ…å«ç”¨æˆ·ä»»åŠ¡ã€å›¾ç»“æ„ä¸è´¦æœ¬çŠ¶æ€ï¼Œä¹ŸåŒ…å«æ‰§è¡Œæ—¥å¿—ã€æµ‹è¯•ç»†èŠ‚ã€è·¨ Agent çš„æ¶ˆæ¯ä¸ä¾èµ–ã€è·¯å¾„ä¸æ–‡ä»¶ç³»ç»Ÿç»“æ„ã€ä»¥åŠå¯æŒä¹…åŒ–çš„å·¥ä½œè®°å¿†ã€‚æœ¬æ–‡è¯¦ç»†å‰–æé¡¹ç›®ä¸­ä¸Šä¸‹æ–‡çš„æ¥æºã€å½¢æ€ã€æµè½¬è·¯å¾„ã€æŒä¹…åŒ–æ–¹å¼ã€æŸ¥è¯¢ä¸å¤ç”¨ç­–ç•¥ï¼Œä»¥åŠå®ƒå¦‚ä½•é©±åŠ¨ç¼–æ’ã€å†³ç­–ã€å®¹é”™å’Œåä½œã€‚

---

## 1. ä»€ä¹ˆæ˜¯â€œä¸Šä¸‹æ–‡â€

- ä»»åŠ¡ä¸Šä¸‹æ–‡ï¼šç”¨æˆ·ä»»åŠ¡æè¿°ã€éœ€æ±‚æ‹†è§£ã€å…¨å±€äº‹å®ä¸è®¡åˆ’ã€å·¥ç¨‹å‘½åä¸æ–‡ä»¶è·¯å¾„ç­‰
- æ‰§è¡Œä¸Šä¸‹æ–‡ï¼šæ¯ä¸ª Agent çš„çŠ¶æ€ã€ä¾èµ–ã€å†å²æ‰§è¡Œè®°å½•ã€å¤±è´¥åŸå› ä¸é‡è¯•æ¬¡æ•°
- åä½œä¸Šä¸‹æ–‡ï¼šAgent é—´çš„æ¶ˆæ¯ã€è¯·æ±‚ã€å»ºè®®ã€ä¾èµ–è¾“å‡ºä¸å»ºè®®çš„ä¸‹ä¸€æ­¥è¡ŒåŠ¨
- ç¯å¢ƒä¸Šä¸‹æ–‡ï¼šå·¥ä½œç›®å½•ã€è·¯å¾„ç»“æ„ã€æµ‹è¯•ä¸æºæ–‡ä»¶å‘ç°ã€Python å¯¼å…¥è·¯å¾„ç­‰
- æŒä¹…åŒ–ä¸Šä¸‹æ–‡ï¼šæ‰§è¡Œæ—¥å¿—å‘é‡åŒ–è¯­ä¹‰ç´¢å¼•ã€å®Œæ•´å•æµ‹è¾“å‡ºè®°å½•ã€Agent çŠ¶æ€å¿«ç…§ã€å·¥ä½œæµæ¨¡å¼ç­‰

è¿™äº›ä¸Šä¸‹æ–‡è¢«ç»“æ„åŒ–åœ°è½åœ¨ä»¥ä¸‹æ ¸å¿ƒéƒ¨ä»¶ä¸­ï¼šTaskLedger/ProgressLedgerã€WorkflowLoggerã€IntelligentPathResolverã€ChromaDB Memory å­ç³»ç»Ÿï¼ˆExecutionLogManager/AgentStateManager/AgentCommunicationMemory/UnitTestMemoryManagerï¼‰ã€ä»¥åŠ Orchestrator çš„â€œå¢å¼ºæç¤ºç”Ÿæˆâ€å’Œâ€œæ™ºèƒ½èŠ‚ç‚¹é€‰æ‹©â€ã€‚

---

## 2. æ¶æ„å…¨è²Œï¼šä¸Šä¸‹æ–‡çš„â€œç”Ÿäº§â€”æ¶ˆè´¹â€”æ²‰æ·€â€”å¤ç”¨â€é—­ç¯

- ç”Ÿäº§ï¼šå„ Agent åœ¨æ‰§è¡Œä¸­äº§å‡ºçŠ¶æ€ä¸äº§ç‰©ï¼ˆä»£ç ã€æµ‹è¯•ã€æŠ¥å‘Šï¼‰ï¼›ç¼–æ’å™¨æ²‰æ·€äº‹å®ä¸è®¡åˆ’ï¼›æ—¥å¿—å™¨å†™å…¥äººç±»å‹å¥½çš„è¿è¡Œè®°å½•
- æ¶ˆè´¹ï¼šåç»­ Agent è¯»å–å‰ç½®è¾“å‡ºã€æ¥æ”¶æ¶ˆæ¯ï¼›Refactoring æ ¹æ® UnitTest çš„ä¸Šä¸‹æ–‡åšç²¾å‡†ä¿®å¤ï¼›ç¼–æ’å™¨å°†è´¦æœ¬çŠ¶æ€+æ¶ˆæ¯+è·¯å¾„ä¿¡æ¯åˆæˆä¸ºâ€œå¢å¼ºæç¤ºâ€
- æ²‰æ·€ï¼šExecutionLogManager å‘é‡åŒ–å­˜å‚¨æ‰§è¡Œè®°å½•ï¼›UnitTestMemoryManager å®Œæ•´å­˜å‚¨æµ‹è¯•è¾“å‡ºï¼›AgentStateManager æŒä¹…åŒ–å¿«ç…§ï¼›CommunicationMemory å­˜å‚¨å¯¹è¯ä¸ä¸Šä¸‹æ–‡ç‰‡æ®µ
- å¤ç”¨ï¼šå¯¹ç›¸ä¼¼ä»»åŠ¡å¯æ£€ç´¢å†å²æˆåŠŸè·¯å¾„ï¼›Refactoring å¤ç”¨å¤±è´¥æ¨¡å¼ä¸ä¿®å¤å»ºè®®ï¼›ä¸‹ä¸€è½®æ‰§è¡Œæ²¿ç”¨ä¾èµ–å›¾ã€å·¥ä½œç›®å½•ã€å·²çŸ¥è·¯å¾„ç­‰

---

## 3. ä¸Šä¸‹æ–‡çš„ç»“æ„åŒ–è½½ä½“

### 3.1 ä»»åŠ¡è´¦æœ¬ï¼ˆTaskLedgerï¼‰ä¸è¿›åº¦è´¦æœ¬ï¼ˆProgressLedgerï¼‰
- ä»»åŠ¡è´¦æœ¬è®°å½•â€œå…¨å±€äº‹å®ä¸è®¡åˆ’â€ã€Agent èƒ½åŠ›æè¿°ã€åŠ¨æ€é¡¹ç›®é…ç½®ä¸æ–‡ä»¶è·¯å¾„
- è¿›åº¦è´¦æœ¬è®°å½•â€œèŠ‚ç‚¹çŠ¶æ€ã€å†å²è½¨è¿¹ã€å½“å‰æ´»è·ƒèŠ‚ç‚¹ã€é‡è¯•æ¬¡æ•°ã€ä¸ºèŠ‚ç‚¹ç”Ÿæˆçš„å…·ä½“æ‰§è¡ŒæŒ‡ä»¤â€ç­‰

ç¤ºä¾‹ï¼ˆæ–‡ä»¶è·¯å¾„ä¸è·¯å¾„è§£æå™¨ç»‘å®šï¼‰ï¼š
````python path=src/core/data_structures.py mode=EXCERPT
def get_file_path(self, file_type: str) -> str:
    if file_type == "main":
        return self.project_config.get("main_file_path", "/Users/jabez/output/main.py")
    elif file_type == "test":
        return self.project_config.get("test_file_path", "/Users/jabez/output/test_main.py")
    else:
        return f"{self.project_config.get('base_dir', '/Users/jabez/output')}/{file_type}"

def get_intelligent_path_resolver(self):
    from .path_resolver import IntelligentPathResolver
    return IntelligentPathResolver(self.project_config, self.facts, self.plan)
````

ä»·å€¼ï¼š
- å°†â€œä»»åŠ¡è¯­ä¹‰â€è½¬è¯‘ä¸ºâ€œå¯æ‰§è¡Œçš„å·¥ç¨‹é…ç½®â€ï¼šå‘½åã€è·¯å¾„ã€ä¾èµ–å›¾ã€Agent èƒ½åŠ›è¡¨
- ä¸º OrchestratorHelpers ç”Ÿæˆâ€œå¢å¼ºæç¤ºâ€æä¾›å¼ºä¸Šä¸‹æ–‡æ¥æº

### 3.2 WorkflowLoggerï¼ˆäººè¯»å‹å¥½çš„ä¸Šä¸‹æ–‡ç¼–å¹´å²ï¼‰
- ä»¥ Markdown+JSON ä¸¤ç§æ–¹å¼è¾“å‡ºï¼šä»»åŠ¡ä¿¡æ¯ã€Agent å¼€å§‹/å®ŒæˆçŠ¶æ€ã€è€—æ—¶ã€è¾“å‡ºæ‘˜è¦ã€ç”Ÿæˆæ–‡ä»¶åˆ—è¡¨
- é¢å‘äººç±»å¯è¯»æ€§ï¼Œå¸®åŠ©è¿½è¸ªæ¯ä¸€æ­¥ä¸Šä¸‹æ–‡æ¼”è¿›

### 3.3 IntelligentPathResolverï¼ˆæ™ºèƒ½è·¯å¾„è§£æå™¨ï¼‰
- æ‰«æ /Users/jabez/output åŠå­ç›®å½•ï¼Œå‘ç° main/test/utils ä¸ Python æ–‡ä»¶
- æ¨èå·¥ä½œç›®å½•ã€ä¿®æ­£ sys.pathï¼Œä¾› UnitTest/Refactoring ç­‰ä½¿ç”¨
- æä¾›â€œè·¯å¾„è§£ææŠ¥å‘Šâ€ï¼Œçº³å…¥å¢å¼ºæç¤º

---

## 4. Memory å­ç³»ç»Ÿï¼ˆChromaDB å‘é‡åŒ– + æ–‡ä»¶å¿«ç…§ï¼‰

### 4.1 åŸºç¡€é…ç½®ï¼ˆç»Ÿä¸€æ¨¡å‹ã€é›†åˆåã€åº¦é‡ï¼‰
- é›†åˆï¼šagent_execution_logsã€workflow_patterns
- æ¨¡å‹ï¼šparaphrase-multilingual-MiniLM-L12-v2ï¼ˆ384 ç»´ï¼‰ï¼Œè·ç¦»ï¼šcosine
- è·¯å¾„ï¼š./memory/execution_logsã€./memory/workflow_patternsã€./memory/agent_states

é…ç½®ç‰‡æ®µï¼š
````python path=src/memory/memory_config.py mode=EXCERPT
return ChromaDBVectorMemory(
    config=PersistentChromaDBVectorMemoryConfig(
        collection_name="agent_execution_logs",
        persistence_path=str(self.execution_logs_path),
        k=50, score_threshold=0.0, distance_metric="cosine",
        embedding_function_config=SentenceTransformerEmbeddingFunctionConfig(
            model_name="paraphrase-multilingual-MiniLM-L12-v2"
        ),
    )
)
````

### 4.2 ExecutionLogManagerï¼šè¯­ä¹‰æ—¥å¿—ä¸ç›¸ä¼¼æ£€ç´¢
- record_executionï¼šå°† Agent åã€ä»»åŠ¡ã€æˆåŠŸæ ‡è®°ã€è€—æ—¶ã€ä¸Šä¸‹æ–‡è¦ç‚¹å†™å…¥å‘é‡åº“
- get_similar_executionsï¼šæŒ‰â€œAgent/è‡ªç”±æ–‡æœ¬â€æ£€ç´¢ç›¸ä¼¼æ‰§è¡Œç‰‡æ®µï¼ˆè§„é¿äº† AutoGen çš„ Chroma æŸ¥è¯¢ bugï¼Œç›´æ¥ä½¿ç”¨åº•å±‚ collection.queryï¼‰
- get_error_solutionsï¼šå¤šç­–ç•¥æŸ¥è¯¢æˆåŠŸæ¡ˆä¾‹ï¼Œè¾…åŠ©å®šä½ä¿®å¤æ€è·¯

åº”ç”¨ä»·å€¼ï¼š
- å¿«é€Ÿå®šä½â€œç±»ä¼¼ä»»åŠ¡/é”™è¯¯â€çš„å†å²è§£æ³•
- ç»™ Refactoring ä¸åç»­æ‰§è¡Œæä¾›â€œç»éªŒå¢ç›Šçš„ä¸Šä¸‹æ–‡â€

### 4.3 AgentStateManagerï¼šAgent å±€éƒ¨çŠ¶æ€å¿«ç…§
- save/load/listï¼šJSON æ–‡ä»¶åŒ–ï¼Œå¸¦æ—¶é—´æˆ³
- ç”¨äºæœ‰é™æŒä¹…çŠ¶æ€è®°å½•ï¼ˆéè¯­ä¹‰ç´¢å¼•ï¼‰

### 4.4 AgentCommunicationMemoryï¼šè·¨ Agent çš„ä¸Šä¸‹æ–‡æ€»çº¿
- ç»´æŠ¤â€œAgent ä¸Šä¸‹æ–‡ï¼ˆå½“å‰ä»»åŠ¡ã€æ‰§è¡ŒçŠ¶æ€ã€ä¾èµ–ã€è¾“å‡ºï¼‰â€ä¸â€œæ¶ˆæ¯å†å²ï¼ˆcontext/error/result/adviceï¼‰â€
- å°†ä¸Šä¸‹æ–‡ç‰‡æ®µä¸æ¶ˆæ¯ä»¥æ–‡æœ¬å½¢å¼å†™å…¥ workflow_patterns é›†åˆï¼Œä¾¿äºåç»­æ£€ç´¢ä¸å¤ç›˜
- æä¾›æ™ºèƒ½å»ºè®®ï¼šåŸºäºä¾èµ–å®Œæˆæƒ…å†µä¸æ”¶åˆ°çš„é”™è¯¯/ä¸Šä¸‹æ–‡æ¶ˆæ¯ï¼Œç»™å‡º agent çš„ä¸‹ä¸€æ­¥å»ºè®®

åˆå§‹åŒ–ç‰‡æ®µï¼š
````python path=src/memory/agent_communication_memory.py mode=EXCERPT
async def initialize(self):
    if not self._initialized:
        self.communication_memory = memory_config.create_workflow_memory()
        self._initialized = True
        print("ğŸ”— Agenté€šä¿¡Memoryç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ")
````

ä¸ Orchestrator çš„ç»“åˆï¼š
- ç¼–æ’å™¨åœ¨ agent èŠ‚ç‚¹å¼€å§‹/ç»“æŸæ—¶æ›´æ–° Agent ä¸Šä¸‹æ–‡åˆ°é€šä¿¡è®°å¿†
- å°†ä¾èµ– Agent çš„è¾“å‡ºã€æœ€è¿‘å®Œæˆçš„ä¸Šä¸‹æ–‡ã€æ”¶åˆ°çš„æ¶ˆæ¯èåˆåˆ°â€œå¢å¼ºæç¤ºâ€é‡Œ

### 4.5 UnitTestMemoryManagerï¼šä¿çœŸåº¦æé«˜çš„å•æµ‹ä¸Šä¸‹æ–‡
- record_complete_test_executionï¼šä¿å­˜â€œåŸå§‹è¾“å‡º+è§£æç»“æœ+å¤±è´¥/é”™è¯¯è¯¦ç»†+æ™ºèƒ½åˆ†æ+ä¿®å¤å»ºè®®+æµ‹è¯•æ–‡ä»¶ä¸æŠ¥å‘Šè·¯å¾„â€
- get_detailed_test_info_for_refactoringï¼šä¸ºé‡æ„é˜¶æ®µæä¾›å¯ç›´æ¥æ¶ˆè´¹çš„ç»†ç²’åº¦ä¸Šä¸‹æ–‡

å®Œæ•´è®°å½•ç‰‡æ®µï¼ˆå‡½æ•°ç­¾åä¸èµ·å§‹é€»è¾‘ï¼‰ï¼š
````python path=src/memory/unit_test_memory_manager.py mode=EXCERPT
async def record_complete_test_execution(self,
                                       agent_name: str,
                                       task_description: str,
                                       raw_output: str,
                                       execution_result: Dict[str, Any],
                                       success: bool,
                                       duration: float,
                                       test_files: List[str] = None,
                                       test_reports: Dict[str, Any] = None):
    if not self._initialized:
        await self.initialize()
````

åº”ç”¨ä»·å€¼ï¼š
- å°†â€œå¤±è´¥æ¨¡å¼â†’ä¿®å¤å»ºè®®â€è½¬è¯‘ä¸ºç»“æ„åŒ–ä¸Šä¸‹æ–‡ï¼Œç²¾å‡†å–‚ç»™ RefactoringAgent
- å½¢æˆâ€œå¯è§£é‡Šâ€çš„æµ‹è¯•å›æº¯ææ–™ï¼ˆå¯¹äºº/å¯¹æœºéƒ½å‹å¥½ï¼‰

---

## 5. Orchestrator å¦‚ä½•â€œç”Ÿäº§ä¸æ¶ˆè´¹ä¸Šä¸‹æ–‡â€

### 5.1 ä¸Šä¸‹æ–‡åˆå§‹åŒ–
- initialize_memory_system â†’ åˆå§‹åŒ–å„ Memoryï¼›è½½å…¥/åˆ›å»ºå·¥ä½œæµé›†åˆ
- é…ç½®é“¾è·¯ä¾èµ– â†’ å°† â€œé“¾è·¯é…ç½®â€å†™å…¥ AgentCommunicationMemory çš„ä¾èµ–å›¾ä¸­

### 5.2 æ™ºèƒ½èŠ‚ç‚¹é€‰æ‹©ä¸â€œä¸ºèŠ‚ç‚¹ç”Ÿæˆå…·ä½“æŒ‡ä»¤â€
- _intelligent_node_selectionï¼šåŸºäºå€™é€‰èŠ‚ç‚¹å’Œè¿›åº¦åˆ†æï¼Œç”Ÿæˆâ€œä¸‹ä¸€è¯´è¯è€…+æ‰§è¡ŒæŒ‡ä»¤â€ï¼›æŒ‡ä»¤ç¼“å­˜åˆ° progress_ledger.node_instructions
````python path=src/core/orchestrator.py mode=EXCERPT
self.progress_ledger.current_active_nodes = {selected_node}
if not hasattr(self.progress_ledger, 'node_instructions'):
    self.progress_ledger.node_instructions = {}
self.progress_ledger.node_instructions[selected_node] = instruction
````

- è¿›åº¦åˆ†ææç¤ºèåˆï¼šä»»åŠ¡ã€å›¢é˜Ÿã€æ˜¯å¦å¾ªç¯ã€æ˜¯å¦åœ¨æ¨è¿›ã€ä¸‹ä¸€èŠ‚ç‚¹æ˜¯è°ã€ç»™ä»–ä»€ä¹ˆæŒ‡ä»¤ï¼ˆLLM é©±åŠ¨ï¼Œå…· MagenticOne é£æ ¼ï¼‰

### 5.3 å¢å¼ºæç¤ºæ„å»ºï¼ˆOrchestratorHelpers.build_enhanced_promptï¼‰
- èåˆâ€œèŠ‚ç‚¹å…·ä½“æŒ‡ä»¤+ä»»åŠ¡èƒŒæ™¯+é¡¹ç›®é…ç½®+æ‰§è¡Œè®¡åˆ’+å½“å‰çŠ¶æ€â€ï¼Œå¹¶åœ¨æœ‰è®°å¿†ç³»ç»Ÿæ—¶æ³¨å…¥â€œä¾èµ–è¾“å‡ºã€æ”¶åˆ°æ¶ˆæ¯ã€å»ºè®®è¡ŒåŠ¨â€
- ä¸º RefactoringAgent æ³¨å…¥â€œæµ‹è¯•å¤±è´¥å¿«ç…§â€ç­‰å…³é”®ä¸Šä¸‹æ–‡

ç‰‡æ®µï¼ˆä¸º Agent æ³¨å…¥å·¥ç¨‹è·¯å¾„ä¸Šä¸‹æ–‡ï¼‰ï¼š
````python path=src/core/orchestrator_helpers.py mode=EXCERPT
é¡¹ç›®åç§°ï¼š{orchestrator.task_ledger.project_config.get('project_name', 'æœªè®¾ç½®')}
ä¸»æ–‡ä»¶è·¯å¾„ï¼š{orchestrator.task_ledger.get_file_path('main')}
æµ‹è¯•æ–‡ä»¶è·¯å¾„ï¼š{orchestrator.task_ledger.get_file_path('test')}

ã€å½“å‰çŠ¶æ€ã€‘
{OrchestratorHelpers.format_current_state(orchestrator)}
````

### 5.4 æ‰§è¡Œå‰åä¸Šä¸‹æ–‡æ›´æ–°ä¸æ¶ˆæ¯ä¼ æ’­
- æ‰§è¡Œå‰ï¼šupdate_agent_context(..., execution_state="starting")ï¼›æ”¶é›†ä¾èµ–è¾“å‡ºã€æœ€è¿‘å®Œæˆä¸Šä¸‹æ–‡ã€å·²æ”¶åˆ°æ¶ˆæ¯ï¼Œç”Ÿæˆå¢å¼ºä¸Šä¸‹æ–‡å¿«ç…§
- æ‰§è¡Œåï¼šè®°å½• execution_logã€æ›´æ–°ä¸Šä¸‹æ–‡ä¸ºâ€œcompleted/failedâ€ï¼›å‘ä¾èµ–å½“å‰ Agent çš„åç»­ Agent å‘ result æˆ– error æ¶ˆæ¯ï¼ˆå¸¦æ‘˜è¦/å»ºè®®ï¼‰
- å•æµ‹å¤±è´¥åˆ†æ”¯ï¼šUnitTestAgent å¤±è´¥â†’å‘ RefactoringAgent å‘é€ error/contextï¼ˆå« test_report/test_contextï¼‰ï¼›ä¸ºé‡æ„æä¾›â€œå¯å®šä½/å¯ä¿®å¤â€çš„ä¸Šä¸‹æ–‡

---

## 6. ç¯å¢ƒä¸è·¯å¾„ä¸Šä¸‹æ–‡

### 6.1 æ™ºèƒ½è·¯å¾„è§£æ
- æ¢æµ‹ project_rootã€main/test/utilsï¼›ç»Ÿè®¡ Python æ–‡ä»¶ï¼›å¹¶ç»™å‡ºè¯„åˆ†ä¸å·¥ä½œç›®å½•æ¨è
- UnitTestAgent çš„ç³»ç»Ÿæ¶ˆæ¯ä¸­åµŒå…¥äº†â€œæ™ºèƒ½è·¯å¾„è®¾ç½®èŒƒå¼â€ï¼ˆå˜æ›´å·¥ä½œç›®å½•ã€ä¿®æ­£ sys.pathã€åŠ¨æ€å¯¼å…¥æµ‹è¯•æ¨¡å—ï¼‰

### 6.2 åŠ¨æ€æ–‡ä»¶å‘½åä¸è·¯å¾„æŒ‡ä»¤
- PlanningAgent/CodingAgent/TestGenerationAgent çš„ç³»ç»Ÿæç¤ºé‡Œä¸¥æ ¼è¦æ±‚ä½¿ç”¨ /Users/jabez/output ä¸‹çš„æ˜ç¡®è·¯å¾„
- TaskLedger.get_file_path ä¸ºâ€œå¢å¼ºæç¤ºâ€ä¸â€œä¾èµ–ä¿¡æ¯â€æä¾›ç»Ÿä¸€å£å¾„

---

## 7. å…ƒæ•°æ®ä¸æ£€ç´¢

### 7.1 æ‰§è¡Œæ—¥å¿—ï¼ˆagent_execution_logsï¼‰
- metadata ç¤ºä¾‹ï¼šagent_nameã€successã€timestampã€durationã€task_typeï¼ˆè§„åˆ’/æµ‹è¯•/é‡æ„/æ‰«æ/å…¶ä»–ï¼‰
- contentï¼šèåˆ Agent å/ä»»åŠ¡/æˆåŠŸæ ‡è®°/è€—æ—¶/ç»“æœæ‘˜è¦/ä¸Šä¸‹æ–‡æ‘˜è¦
- æ£€ç´¢ï¼šæ”¯æŒæŒ‰ Agentã€æŒ‰æ¨¡ç³Šå…³é”®è¯ã€æŒ‰æˆåŠŸ/å¤±è´¥è¿‡æ»¤ã€Top-K

### 7.2 å·¥ä½œæµæ¨¡å¼ï¼ˆworkflow_patternsï¼‰
- å­˜å‚¨ Agent ä¸Šä¸‹æ–‡å¿«ç…§ã€æ¶ˆæ¯ã€å•æµ‹å®Œæ•´è®°å½•ç­‰
- å¯æŒ‰æ¶ˆæ¯ç±»å‹ã€Agent åç§°ã€æ—¶é—´ç­›é€‰ï¼Œæ”¯æ’‘â€œå¯¹è¯/ä¸Šä¸‹æ–‡å›æ”¾â€

---

## 8. å¦‚ä½•ä½¿ç”¨ä¸è§‚æµ‹ä¸Šä¸‹æ–‡ï¼ˆå®åŠ¡å»ºè®®ï¼‰

- è§‚å¯Ÿäººè¯»æ—¥å¿—ï¼š
  - è¿è¡ŒåæŸ¥çœ‹ /Users/jabez/output/logs/ ä¸‹ç”Ÿæˆçš„ workflow_*.md ä¸ *.json
- æŸ¥çœ‹ Memory æŒä¹…åŒ–ï¼š
  - ./memory/execution_logs, ./memory/workflow_patterns ä¸‹çš„ ChromaDB æ•°æ®ç›®å½•
  - ./memory/agent_states ä¸‹çš„ JSON å¿«ç…§
- ç¨³å¦¥æ¸…ç†ï¼š
  - åœ¨å¼€å‘/è°ƒè¯•é˜¶æ®µå¯æŒ‰éœ€æ¸…ç©º ./memory ä¸‹å­ç›®å½•ï¼Œä½†æ³¨æ„è®­ç»ƒ/ç»éªŒæŸå¤±
- è¯Šæ–­å»ºè®®ï¼š
  - å•æµ‹ä¸é€šè¿‡æ—¶ä¼˜å…ˆæŸ¥çœ‹ test_report.json/md ä¸ UnitTestMemoryManager çš„è®°å½•ï¼ˆå«å¤±è´¥æ¨¡å¼ä¸ä¿®å¤å»ºè®®ï¼‰
  - é€šè¿‡ ExecutionLogManager.get_error_solutions æŸ¥è¯¢å†å²æˆåŠŸä¿®å¤ç»éªŒ
- å®‰å…¨ä¸åˆè§„ï¼š
  - é¿å…æŠŠæ•æ„Ÿä¿¡æ¯å†™å…¥å‘é‡åº“æ˜æ–‡ï¼ˆå¦‚å¯†é’¥ã€éšç§æ•°æ®ï¼‰
  - è¯­ä¹‰ç´¢å¼•æ•°æ®å¯èƒ½è¢«â€œç›¸ä¼¼æŸ¥è¯¢â€å¬å›ï¼Œåº”åšå¥½åˆ†çº§è„±æ•ä¸è®¿é—®æ§åˆ¶

---

## 9. ä¸â€œè‡ªåŠ¨é“¾è·¯é€‰æ‹©/å›¾æ„ŸçŸ¥å†³ç­–â€çš„å…³ç³»

- å¤æ‚åº¦åˆ†æå™¨ TaskComplexityAnalyzer å·²å®ç°ï¼Œå¯å¯¹ä»»åŠ¡è¿›è¡Œå¤šç»´æ‰“åˆ†ä¸æ¡£ä½åˆ’åˆ†ï¼ˆtrivial/simple/moderate/complex/very_complexï¼‰
- å½“å‰ä¸»æµç¨‹çš„é“¾è·¯é€‰æ‹©ç”± CLI å‚æ•°æˆ–é»˜è®¤é…ç½®ç¡®å®šï¼›å¯åœ¨å…¥å£é›†æˆâ€œå…ˆè°ƒç”¨åˆ†æå™¨ï¼Œå†é€‰é“¾â€çš„é€»è¾‘ï¼Œä½¿â€œä¸Šä¸‹æ–‡ï¼ˆå¤æ‚åº¦ï¼‰â†’é“¾è·¯â€è‡ªåŠ¨åŒ–é—­ç¯
- Orchestrator å·²å…·å¤‡â€œä¸‹ä¸€èŠ‚ç‚¹+æŒ‡ä»¤â€çš„ LLM å†³ç­–ä¸è´¦æœ¬èåˆï¼›æœªæ¥å¯æŠ½è±¡å‡º DecisionEngine/GraphAnalyzer/ProgressAnalyzer çš„å®ä½“ç±»ï¼Œä»¥å¼ºåŒ–â€œæ¶æ„ä¸å®ç°åè¯çš„æ˜ å°„ä¸€è‡´æ€§â€

---

## 10. æœªæ¥è·¯çº¿å›¾ï¼ˆContext Roadmapï¼‰

1) è‡ªåŠ¨é€‰é“¾ä¸Šçº¿
   - åœ¨ minimal_main/main å…¥å£å¤„æ¥ TaskComplexityAnalyzerï¼ŒåŸºäºå¤æ‚åº¦â†’ï¼ˆprototype/minimal/quality/standardï¼‰æ˜ å°„
2) æ‰«æ MCP ä¸ fetch-mcp çœŸæ¥å…¥
   - å°† CodeScanningAgent çš„å·¥å…·ä»æœ¬åœ°å‡½æ•°æ›¿æ¢/è¡¥å……ä¸º MCP å·¥å…·ï¼Œä»¥ç»Ÿä¸€â€œä¸Šä¸‹æ–‡å¤–éƒ¨åŒ–æœåŠ¡â€å½¢æ€
3) RAG å¼ºåŒ–ä¸â€œç”Ÿæˆä¸Šä¸‹æ–‡æ³¨å…¥â€
   - åœ¨ä»£ç ç”Ÿæˆ/é‡æ„æç¤ºä¸­æ£€ç´¢ ExecutionLog/WorkflowPatterns çš„é«˜ç›¸å…³ç‰‡æ®µï¼Œä½œä¸ºâ€œæ™ºèƒ½æç¤ºèƒŒæ™¯â€
4) ä¸Šä¸‹æ–‡å®‰å…¨å±‚
   - å¼•å…¥â€œæ•æ„Ÿä¿¡æ¯æ ‡æ³¨/è„±æ•å­˜å‚¨ç­–ç•¥â€ï¼›é’ˆå¯¹å‘é‡åº“å±‚æ·»åŠ â€œåŠ å¯†/è®¿é—®çº§åˆ«â€
5) å†³ç­–å¼•æ“å®ä½“åŒ–
   - å°†ç›®å‰åˆ†å¸ƒåœ¨ Orchestrator å†…çš„æ™ºèƒ½å†³ç­–é€»è¾‘æç‚¼ä¸º DecisionEngine/GraphAnalyzer/ProgressAnalyzer ç±»ï¼Œå¢å¼ºå¯æµ‹æ€§ä¸æ‰©å±•æ€§

---

## 11. å…³é”®ç‰‡æ®µç´¢å¼•ï¼ˆä¾¿äºäºŒæ¬¡ç ”ç©¶ï¼‰

- è¿›åº¦è´¦æœ¬ä¸ºèŠ‚ç‚¹æ³¨å…¥â€œå…·ä½“æŒ‡ä»¤â€çš„ç¼“å­˜ï¼š
````python path=src/core/orchestrator.py mode=EXCERPT
self.progress_ledger.current_active_nodes = {selected_node}
if not hasattr(self.progress_ledger, 'node_instructions'):
    self.progress_ledger.node_instructions = {}
self.progress_ledger.node_instructions[selected_node] = instruction
````

- ä¸ºâ€œå¢å¼ºæç¤ºâ€æ³¨å…¥ç»Ÿä¸€è·¯å¾„ä¸Šä¸‹æ–‡ï¼š
````python path=src/core/orchestrator_helpers.py mode=EXCERPT
ä¸»æ–‡ä»¶è·¯å¾„ï¼š{orchestrator.task_ledger.get_file_path('main')}
æµ‹è¯•æ–‡ä»¶è·¯å¾„ï¼š{orchestrator.task_ledger.get_file_path('test')}

ã€å½“å‰çŠ¶æ€ã€‘
{OrchestratorHelpers.format_current_state(orchestrator)}
````

- å·¥ä½œè®°å¿†ï¼ˆworkflow_patternsï¼‰ç”¨äºé€šä¿¡è®°å¿†ï¼š
````python path=src/memory/agent_communication_memory.py mode=EXCERPT
if not self._initialized:
    await self.initialize()

await self.communication_memory.add(
    MemoryContent(content=content, mime_type=MemoryMimeType.TEXT, metadata={...})
)
````

- æ‰§è¡Œæ—¥å¿—ï¼ˆagent_execution_logsï¼‰é…ç½®ï¼š
````python path=src/memory/memory_config.py mode=EXCERPT
collection_name="agent_execution_logs",
k=50, score_threshold=0.0, distance_metric="cosine",
````

- å•æµ‹å®Œæ•´è®°å½•å…¥å£ï¼ˆä¿çœŸä¸Šä¸‹æ–‡ï¼‰ï¼š
````python path=src/memory/unit_test_memory_manager.py mode=EXCERPT
async def record_complete_test_execution(...):
    if not self._initialized:
        await self.initialize()
````

- ä»»åŠ¡è´¦æœ¬æš´éœ²çš„è·¯å¾„è§£æå™¨ï¼š
````python path=src/core/data_structures.py mode=EXCERPT
def get_intelligent_path_resolver(self):
    from .path_resolver import IntelligentPathResolver
    return IntelligentPathResolver(self.project_config, self.facts, self.plan)
````

---

## ç»“è¯­
æœ¬é¡¹ç›®çš„ä¸Šä¸‹æ–‡ç®¡ç†ä¸æ˜¯è¢«åŠ¨çš„â€œæ—¥å¿—å †ç Œâ€ï¼Œè€Œæ˜¯å¼ºè€¦åˆäºç¼–æ’ã€åä½œã€å†³ç­–ä¸å®¹é”™çš„â€œçŸ¥è¯†å¾ªç¯ç³»ç»Ÿâ€ã€‚å®ƒå°†å¤šå±‚ä¸Šä¸‹æ–‡ï¼ˆä»»åŠ¡ã€æ‰§è¡Œã€åä½œã€ç¯å¢ƒã€è®°å¿†ï¼‰æ±‡å…¥ç»Ÿä¸€çš„ç¼–æ’ä¸æç¤ºèŒƒå¼ï¼ŒæŒç»­äº§ç”Ÿå¯å¤ç”¨çš„ç»éªŒèµ„äº§ã€‚éšç€è‡ªåŠ¨é€‰é“¾ã€MCP æ·±åº¦é›†æˆä¸ RAG æ³¨å…¥çš„æ¨è¿›ï¼Œè¿™ä¸€ä¸Šä¸‹æ–‡ç³»ç»Ÿå°†è¿›ä¸€æ­¥æˆä¸ºé¡¹ç›®æ™ºèƒ½åŒ–çš„â€œå‘åŠ¨æœºâ€ã€‚
