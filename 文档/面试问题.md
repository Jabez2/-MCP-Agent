## 课题如何实现 Agent 的意图识别
总体结论：由于该课题是专注于代码生成智能体，因此任务主要集中于与代码生成相关的方面。
- 意图识别=“下一步由谁来执行，具体执行什么指令”的智能路由

课题未采用单独的“意图分类器”模型，而是通过“编排器 + 进度账本（Progress Ledger）+ LLM 提示词”的组合来完成意图识别。核心是让 LLM 基于当前任务上下文、团队角色能力、已执行进度等信息，输出：

- next_speaker：下一位应当执行的 Agent（谁）
- instruction_or_question：要给该 Agent 的具体指令或问题（做什么）

并辅以：

- 静态链路配置作为回退顺序（规则路由）
- 执行失败/停滞的阈值机制触发“重新选择 Agent”或“重新规划”（自愈）
- 任务内外环（MagenticOne 风格）协同，让外环进行事实/计划维护，内环推进执行与路由

### 关键输入信号
- 任务与项目配置：动态生成主代码/测试文件路径、项目名等
- 团队与能力描述：参与者列表及其功能描述（agent_capabilities）
- 进度账本（ProgressLedger）：节点状态、重试计数、停滞次数、已生成的“具体指令”等
- 执行结果分析：上一步 Agent 的成功/失败、输出摘要、错误类型
- 链路配置（chain_config）：标准顺序作为保底路由
- 路径解析器（PathResolver）：对初始路径的智能解析与报告

### 实现机制
1）外环：事实/计划生成，确定智能路径基线
- Orchestrator 先用 LLM 产出 facts 与 plan，内含“可用 Agent 团队”和“项目文件路径”等上下文，作为后续路由的语义基础。
- 初始化智能路径解析器（TaskLedger.get_intelligent_path_resolver）生成路径报告，作为图式流程的基线参考。

2）内环核心：基于“进度账本”的 LLM 路由(智能节点选择)
- 当候选 Agent 多于一个时，调用“进度账本分析”提示词，请 LLM 产出结构化 JSON，包含 next_speaker 与 instruction_or_question 等字段。
- 若只有一个候选，则直接为该 Agent 生成更具体的执行指令（instruction）。

3）失败与停滞触发处理(再选择/再规划)
- 连续失败次数达到阈值（>=2）时，触发“重新选择 Agent”
- 若整体流程“停滞次数”达到阈值（max_stalls），触发“外环重新规划”，即重新进行 facts/plan 分析，再进入内环推进

4）针对角色的定制系统指令，提升“指令/意图”清晰度
- 每个 Agent 有明确的系统消息模板和职责，规划阶段要求指明目标文件路径与保存位置，保证“下一步指令”具体可执行。
- 每个 Agent 配置专门的 MCP 服务器，确保所调用的工具和资源在其职责范围之内，减少发生意料之外操作的可能性。
### 传统意图识别
- 基于规则和关键词
- 传统机器学习方法：采用监督学习训练意图分类模型
- CNN、RNN、LSTM、GRU
### 区别
- 非单点分类器：没有把“意图识别”做成固定标签的分类任务；而是交由 LLM 在上下文中综合判断下一步“谁来执行”以及“执行什么”。
- 语义驱动+规则兜底：LLM 驱动的语义路由作为主路径，静态链路/失败停滞阈值作为兜底和自愈机制。
- 双环协同：外环维护事实/计划，内环推进执行。停滞反馈会让外环重新规划，从而修正后续“意图”和路线。

## 总结
- 课题的“意图识别”实质是“面向团队多 Agent 的智能路由”，由 LLM 依据进度账本和团队能力决定“下一个 Agent 以及给 TA 的具体指令”，并以链路配置、失败/停滞阈值作为稳定性与自愈的支撑。
- 这种做法把“谁来做什么”的决策留给 LLM 的结构化输出，从而具备较强的上下文感知与灵活性。