# åŸºäºMCPçš„å¤šé“¾ä»£ç ç”Ÿæˆæ™ºèƒ½ä½“Agentå¼€å‘è¯¾é¢˜æ€»ç»“

## è¯¾é¢˜æ¦‚è¿°

æœ¬è¯¾é¢˜è®¾è®¡å¹¶å®ç°äº†ä¸€ä¸ªåŸºäº MCP(Model Context Protocol)çš„å¤šé“¾ä»£ç ç”Ÿæˆæ™ºèƒ½ä½“ç³»ç»Ÿï¼Œç»“åˆ AutoGen æ¡†æ¶ä¸­çš„ GraphFlow ç»“æ„åŒ–æ‰§è¡Œå’Œ MagenticOne åŒè´¦æœ¬é£æ ¼è°ƒåº¦ï¼Œå®ç°äº†ä»éœ€æ±‚åˆ†æåˆ°ä»£ç ç”Ÿæˆã€æµ‹è¯•ã€é‡æ„ã€è´¨é‡æ‰«æçš„è‡ªåŠ¨åŒ–å¼€å‘å·¥ä½œæµã€‚
## GitHub åœ°å€
https://github.com/Jabez2/-MCP-Agent
## æ ¸å¿ƒå·¥ä½œ

- **å¤šé“¾è·¯æ”¯æŒ**ï¼šæ”¯æŒä¸åŒå¤æ‚åº¦çš„æ‰§è¡Œé“¾è·¯ï¼Œå¯æ ¹æ®ä»»åŠ¡å¤æ‚åº¦é€‰æ‹©æœ€ä¼˜è·¯å¾„
- **MCPæœåŠ¡é›†æˆ**ï¼šé›†æˆå¤šä¸ªä¸“ä¸šMCPæœåŠ¡ï¼Œå®ç°Agentå·¥å…·èƒ½åŠ›æ‰©å±•
- **å‘é‡åŒ–è®°å¿†**ï¼šåŸºäºChromaDBå‘é‡æ•°æ®åº“è®°å¿†å­˜å‚¨ï¼Œæ”¯æŒ Agent ä¸Šä¸‹æ–‡å…±äº«å’Œæ‰§è¡Œè®°å½•å­˜å‚¨
- **åŒè´¦æœ¬çŠ¶æ€ç®¡ç†**ï¼šTaskLedger + ProgressLedger å®ç°ä»»åŠ¡å±‚å’Œæ‰§è¡Œå±‚çš„çŠ¶æ€è®°å½•

## ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```mermaid
flowchart LR
    %% å·¦ä¾§ï¼šè¾“å…¥å’Œè°ƒåº¦
    subgraph Left["ç”¨æˆ·è¾“å…¥ä¸è°ƒåº¦å±‚"]
        User["ğŸ‘¤ ç”¨æˆ·è¾“å…¥<br/>ğŸ“ ä»»åŠ¡éœ€æ±‚æè¿°<br/>ğŸ¯ åŠŸèƒ½è§„æ ¼è¯´æ˜"]

        subgraph Orchestration["ğŸ¯ è°ƒåº¦å±‚"]
            Core["ğŸ® æ ¸å¿ƒç¼–æ’å™¨<br/>GraphFlowOrchestrator<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ èŠ‚ç‚¹é€‰æ‹©<br/>â€¢ æµç¨‹æ§åˆ¶ç®¡ç†<br/>â€¢ å¼‚å¸¸å¤„ç†æœºåˆ¶"]

            Ledgers["ğŸ“Š åŒè´¦æœ¬ç³»ç»Ÿ<br/>MagenticOneé£æ ¼<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ TaskLedger ä»»åŠ¡è´¦æœ¬<br/>â€¢ ProgressLedger è¿›åº¦è´¦æœ¬<br/>â€¢ çŠ¶æ€åŒæ­¥ç®¡ç†"]

            Intelligence["ğŸ§  åˆ†æå¼•æ“<br/>TaskComplexityAnalyzer<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ ä»»åŠ¡å¤æ‚åº¦è¯„ä¼°<br/>â€¢ é“¾è·¯é€‰æ‹©å†³ç­–<br/>"]

            Core --- Ledgers
            Ledgers --- Intelligence
        end
    end

    %% ä¸­é—´ï¼šæ‰§è¡Œå’ŒæœåŠ¡
    subgraph Middle["æ‰§è¡Œä¸æœåŠ¡"]
        subgraph Execution["ğŸ¤– Agentæ‰§è¡Œå±‚"]
            AgentChain["ğŸ”— Agentåä½œé“¾<br/>7ä¸ªä¸“ä¸šAgent<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ CodePlanningAgent<br/>â€¢ FunctionWritingAgent<br/>â€¢ TestGenerationAgent<br/>â€¢ UnitTestAgent<br/>â€¢ RefactoringAgent<br/>â€¢ CodeScanningAgent<br/>â€¢ ProjectStructureAgent"]

            Runtime["ğŸš€ æ‰§è¡Œå¼•æ“<br/>AutoGen Framework<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ Agentè¿è¡Œæ—¶ç®¡ç†<br/>â€¢ ChainFactoryé“¾è·¯å·¥å‚<br/>"]

            Communication["ğŸ“¡ é€šä¿¡åè°ƒ<br/>Message & State Sync<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ Agenté—´æ¶ˆæ¯ä¼ é€’<br/>â€¢ çŠ¶æ€åŒæ­¥æœºåˆ¶<br/>"]

            AgentChain --- Runtime
            Runtime --- Communication
        end

        subgraph Services["ğŸ”Œ MCPæœåŠ¡å±‚"]
            FileSystem["ğŸ“‚ æ–‡ä»¶ç³»ç»ŸæœåŠ¡<br/>filesystem-mcp-server<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ æ–‡ä»¶è¯»å†™æ“ä½œ<br/>â€¢ ç›®å½•ç®¡ç†<br/>â€¢ æƒé™æ§åˆ¶"]

            CodeRunner["â–¶ï¸ ä»£ç æ‰§è¡ŒæœåŠ¡<br/>code-runner-mcp<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ Pythonä»£ç æ‰§è¡Œ<br/>â€¢ æµ‹è¯•è¿è¡Œ<br/>â€¢ ç»“æœæ•è·"]

            CodeScanner["ğŸ” ä»£ç åˆ†ææœåŠ¡<br/>code-scanner-mcp<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ é™æ€ä»£ç åˆ†æ<br/>â€¢ è´¨é‡æ£€æµ‹<br/>â€¢ å®‰å…¨æ‰«æ"]

            Network["ğŸŒ ç½‘ç»œæœåŠ¡<br/>fetch-mcp<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ HTTPè¯·æ±‚<br/>â€¢ APIè°ƒç”¨<br/>â€¢ å¤–éƒ¨é›†æˆ"]

            FileSystem --- CodeRunner
            CodeRunner --- CodeScanner
            CodeScanner --- Network
        end
    end

    %% å³ä¾§ï¼šå­˜å‚¨å’Œè¾“å‡º
    subgraph Right["å­˜å‚¨ä¸è¾“å‡º"]
        subgraph Storage["ğŸ’¾ å­˜å‚¨å±‚"]
            direction LR
            VectorDB["ğŸ—„ï¸ å‘é‡è®°å¿†ç³»ç»Ÿ<br/>ChromaDB Database<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ æ‰§è¡Œæ—¥å¿—å­˜å‚¨<br/>â€¢ è¯­ä¹‰æœç´¢æ£€ç´¢<br/>â€¢ ç»éªŒå­¦ä¹ ç§¯ç´¯"]

            FileStore["ğŸ“ æ–‡ä»¶å­˜å‚¨ç³»ç»Ÿ<br/>Project File System<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ æºä»£ç æ–‡ä»¶<br/>â€¢ æµ‹è¯•ç»“æœ<br/>â€¢ é¡¹ç›®æ–‡æ¡£"]

            ConfigMgr["âš™ï¸ é…ç½®ç®¡ç†<br/>Configuration Manager<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ ç¯å¢ƒé…ç½®<br/>â€¢ æ¨¡å‹é…ç½®<br/>â€¢ é“¾è·¯é…ç½®"]
        end
    end

    %% é¡¹ç›®è¾“å‡ºï¼ˆç‹¬ç«‹æ”¾ç½®ï¼‰
    Output["ğŸ“¦ é¡¹ç›®è¾“å‡º<br/>ğŸ‰ å®Œæ•´é¡¹ç›®äº¤ä»˜<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ å®Œæ•´æºä»£ç <br/>â€¢ æµ‹è¯•ç”¨ä¾‹å’ŒæŠ¥å‘Š<br/>â€¢ é¡¹ç›®æ–‡æ¡£<br/>â€¢ è´¨é‡è¯„ä¼°æŠ¥å‘Š"]

    %% ä¸»è¦æ•°æ®æµ
    User ==> Orchestration
    Orchestration ==> Execution
    Execution ==> Services
    Services ==> Storage
    Execution ==> Output

    %% æ™ºèƒ½åé¦ˆå¾ªç¯
    Storage -.->|æ‰§è¡Œæ—¥å¿—æŸ¥è¯¢| Orchestration
    Execution -.->|æ‰§è¡ŒçŠ¶æ€åé¦ˆ| Orchestration

    %% æ ·å¼å®šä¹‰
    classDef userStyle fill:#e3f2fd,stroke:#1976d2,stroke-width:4px,color:#000,font-size:20px
    classDef orchestrationStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px,color:#000,font-size:20px
    classDef executionStyle fill:#e8f5e8,stroke:#388e3c,stroke-width:3px,color:#000,font-size:20px
    classDef servicesStyle fill:#fff3e0,stroke:#f57c00,stroke-width:3px,color:#000,font-size:20px
    classDef storageStyle fill:#fce4ec,stroke:#c2185b,stroke-width:3px,color:#000,font-size:20px
    classDef outputStyle fill:#e0f2f1,stroke:#00695c,stroke-width:4px,color:#000,font-size:16px
    classDef groupStyle fill:#f9f9f9,stroke:#666,stroke-width:2px,color:#333,font-size:20px

    %% åº”ç”¨æ ·å¼
    class User userStyle
    class Orchestration orchestrationStyle
    class Execution executionStyle
    class Services servicesStyle
    class Storage storageStyle
    class Output outputStyle
    class Left,Middle,Right groupStyle
```

</div>

**æ¶æ„ç‰¹ç‚¹**ï¼š

- **è°ƒåº¦å±‚**ï¼šMagenticOneåŒè´¦æœ¬æœºåˆ¶ + å†³ç­–å¼•æ“
- **Agentæ‰§è¡Œå±‚**ï¼š7ä¸ªä¸“ä¸šAgentåä½œ + AutoGenæ‰§è¡Œå¼•æ“
- **MCPæœåŠ¡å±‚**ï¼šæ ‡å‡†åŒ–å·¥å…·æœåŠ¡ + æ¨¡å—åŒ–æ‰©å±•
- **å­˜å‚¨å±‚**ï¼šå‘é‡åŒ–è®°å¿† + æ–‡ä»¶ç³»ç»Ÿ + é…ç½®ç®¡ç†

### MagenticOneåŒè´¦æœ¬æœºåˆ¶
![alt text](https://typoragraph.oss-cn-beijing.aliyuncs.com/test/202508171323290.png)

![alt text](https://typoragraph.oss-cn-beijing.aliyuncs.com/test/202508152254722.png)

#### åŒè´¦æœ¬æœºåˆ¶æ ¸å¿ƒç‰¹æ€§

1. **TaskLedger (ä»»åŠ¡è´¦æœ¬)**ï¼š
   - **ä»»åŠ¡åˆ†è§£**ï¼šå°†å¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºå¯æ‰§è¡Œçš„å­ä»»åŠ¡
   - **ä¾èµ–ç®¡ç†**ï¼šç»´æŠ¤ä»»åŠ¡é—´çš„ä¾èµ–å…³ç³»å’Œæ‰§è¡Œé¡ºåº
   - **å…¨å±€çŠ¶æ€**ï¼šå®æ—¶è·Ÿè¸ªæ•´ä½“ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€

2. **ProgressLedger (è¿›åº¦è´¦æœ¬)**ï¼š
   - **æ‰§è¡Œç›‘æ§**ï¼šå®æ—¶ç›‘æ§æ¯ä¸ªAgentçš„æ‰§è¡ŒçŠ¶æ€
   - **æ€§èƒ½åˆ†æ**ï¼šæ”¶é›†å’Œåˆ†ææ‰§è¡Œæ€§èƒ½æŒ‡æ ‡
   - **ç“¶é¢ˆè¯†åˆ«**ï¼šè¯†åˆ«æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ç“¶é¢ˆç‚¹
   - **ä¼˜åŒ–å»ºè®®**ï¼šåŸºäºå†å²æ•°æ®æä¾›æ‰§è¡Œä¼˜åŒ–å»ºè®®

3. **å†³ç­–æœºåˆ¶**ï¼š
   - **è¿›åº¦åˆ†æ**ï¼šç»¼åˆåˆ†æä»»åŠ¡å’Œè¿›åº¦ä¿¡æ¯
   - **èŠ‚ç‚¹é€‰æ‹©**ï¼šåŸºäºå½“å‰çŠ¶æ€é€‰æ‹©ä¸‹ä¸€ä¸ªæ‰§è¡ŒèŠ‚ç‚¹
   - **é”™è¯¯æ¢å¤**ï¼šåŒ…å«å¤šç§é”™è¯¯æ£€æµ‹å’Œé”™è¯¯æ¢å¤ç­–ç•¥

### åˆ†å±‚æ¶æ„è¯¦ç»†è®¾è®¡

#### è°ƒåº¦å±‚ (Orchestration Layer) - å›¾ç»“æ„ä¸è´¦æœ¬åˆ†æèåˆ

```mermaid
graph TB
    subgraph "ğŸ¯ è°ƒåº¦å±‚ - å›¾ç»“æ„é©±åŠ¨çš„æ™ºèƒ½è°ƒåº¦"
        subgraph "ğŸ“Š å›¾ç»“æ„åˆ†æå¼•æ“"
            GraphAnalyzer[GraphStructureAnalyzer<br/>ğŸ•¸ï¸ å›¾ç»“æ„åˆ†æå™¨<br/>â€¢ ä¾èµ–å›¾æ‹“æ‰‘æ’åº<br/>â€¢ å…³é”®è·¯å¾„è¯†åˆ«<br/>â€¢ å¹¶è¡ŒèŠ‚ç‚¹å‘ç°<br/>â€¢ å¾ªç¯ä¾èµ–æ£€æµ‹]

            PathOptimizer[PathOptimizer<br/>ğŸ›¤ï¸ è·¯å¾„ä¼˜åŒ–å™¨<br/>â€¢ æœ€çŸ­è·¯å¾„è®¡ç®—<br/>â€¢ è´Ÿè½½å‡è¡¡è·¯å¾„<br/>â€¢ å®¹é”™è·¯å¾„è§„åˆ’<br/>â€¢ åŠ¨æ€è·¯å¾„è°ƒæ•´]
        end

        subgraph "æ ¸å¿ƒç¼–æ’å™¨"
            Orchestrator[GraphFlowOrchestrator<br/>ğŸ® ä¸»æ§åˆ¶å™¨<br/>â€¢ å›¾éå†ç­–ç•¥<br/>â€¢ èŠ‚ç‚¹çŠ¶æ€æœºç®¡ç†]
            ChainSelector[ChainSelector<br/>ğŸ”„ é“¾è·¯é€‰æ‹©å™¨<br/>â€¢ åŸºäºå›¾å¤æ‚åº¦é€‰é“¾<br/>â€¢ åŠ¨æ€é“¾è·¯åˆ‡æ¢]
            NodeScheduler[NodeScheduler<br/>ğŸ“… èŠ‚ç‚¹è°ƒåº¦å™¨<br/>â€¢ å›¾æ‹“æ‰‘è°ƒåº¦<br/>â€¢ å¹¶è¡Œæ‰§è¡Œåè°ƒ]
        end

        subgraph "ğŸ”„ MagenticOneåŒè´¦æœ¬ç³»ç»Ÿ"
            TaskLedger[TaskLedger<br/>ğŸ“‹ ä»»åŠ¡è´¦æœ¬ (å›¾ç»“æ„å±‚)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ ä»»åŠ¡ä¾èµ–å›¾æ„å»º<br/>â€¢ èŠ‚ç‚¹ä¼˜å…ˆçº§è®¡ç®—<br/>â€¢ å›¾å®Œæ•´æ€§éªŒè¯<br/>â€¢ å…¨å±€è¿›åº¦è¿½è¸ª]

            ProgressLedger[ProgressLedger<br/>ğŸ“ˆ è¿›åº¦è´¦æœ¬ (æ‰§è¡ŒçŠ¶æ€å±‚)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ èŠ‚ç‚¹æ‰§è¡ŒçŠ¶æ€å®æ—¶æ›´æ–°<br/>â€¢ å›¾éå†æ€§èƒ½ç›‘æ§<br/>â€¢ ç“¶é¢ˆèŠ‚ç‚¹è¯†åˆ«<br/>â€¢ æ‰§è¡Œè·¯å¾„ä¼˜åŒ–å»ºè®®]
        end

        subgraph "ğŸ§  èåˆå†³ç­–åˆ†æ"
            ComplexityAnalyzer[TaskComplexityAnalyzer<br/>ğŸ§  å¤æ‚åº¦åˆ†æå™¨<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ å›¾ç»“æ„å¤æ‚åº¦ (èŠ‚ç‚¹æ•°/è¾¹æ•°)<br/>â€¢ è¯­ä¹‰å¤æ‚åº¦ (ä»»åŠ¡éš¾åº¦)<br/>â€¢ ä¾èµ–å¤æ‚åº¦ (å…³é”®è·¯å¾„é•¿åº¦)<br/>â€¢ å¹¶è¡Œåº¦è¯„ä¼° (å¯å¹¶è¡ŒèŠ‚ç‚¹æ¯”ä¾‹)]

            ProgressAnalyzer[ProgressAnalyzer<br/>ğŸ“Š è¿›åº¦åˆ†æå™¨<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ å›¾éå†æ•ˆç‡åˆ†æ<br/>â€¢ èŠ‚ç‚¹æ‰§è¡Œæ€§èƒ½ç»Ÿè®¡<br/>â€¢ å…³é”®è·¯å¾„ç“¶é¢ˆè¯†åˆ«<br/>â€¢ å¹¶è¡Œæ‰§è¡Œæ•ˆæœè¯„ä¼°]
        end

        subgraph "âš¡ å›¾æ„ŸçŸ¥å†³ç­–å¼•æ“"
            DecisionEngine[DecisionEngine<br/>âš¡ å†³ç­–å¼•æ“<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ åŸºäºå›¾æ‹“æ‰‘çš„èŠ‚ç‚¹é€‰æ‹©<br/>â€¢ è€ƒè™‘ä¾èµ–çº¦æŸçš„è°ƒåº¦<br/>â€¢ å¹¶è¡Œæ‰§è¡Œæœºä¼šè¯†åˆ«<br/>â€¢ å…³é”®è·¯å¾„ä¼˜å…ˆç­–ç•¥]

            ErrorHandler[ErrorHandler<br/>ğŸ›¡ï¸ é”™è¯¯å¤„ç†å™¨<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ å›¾ç»“æ„æ„ŸçŸ¥çš„é”™è¯¯æ¢å¤<br/>â€¢ ä¾èµ–é“¾æ–­è£‚ä¿®å¤<br/>â€¢ æ›¿ä»£è·¯å¾„è‡ªåŠ¨åˆ‡æ¢<br/>â€¢ å›æ»šç‚¹æ™ºèƒ½é€‰æ‹©]
        end
    end

    %% å›¾ç»“æ„åˆ†ææµ
    GraphAnalyzer --> PathOptimizer
    GraphAnalyzer --> TaskLedger
    PathOptimizer --> DecisionEngine

    %% æ ¸å¿ƒç¼–æ’æµ
    Orchestrator --> ChainSelector
    Orchestrator --> NodeScheduler
    Orchestrator --> GraphAnalyzer

    %% åŒè´¦æœ¬äº¤äº’ (æ ¸å¿ƒä¼˜åŠ¿)
    TaskLedger <==> ProgressLedger
    TaskLedger --> GraphAnalyzer

    %% åˆ†æå¼•æ“èåˆ
    ComplexityAnalyzer --> DecisionEngine
    ProgressAnalyzer --> DecisionEngine
    TaskLedger --> ComplexityAnalyzer
    ProgressLedger --> ProgressAnalyzer

    %% å†³ç­–æ‰§è¡Œ
    DecisionEngine --> NodeScheduler
    ErrorHandler --> NodeScheduler
    DecisionEngine --> ErrorHandler

    %% åé¦ˆå¾ªç¯ (å›¾ç»“æ„ä¼˜åŒ–)
    ProgressLedger -.->|æ€§èƒ½åé¦ˆ| PathOptimizer
    ErrorHandler -.->|é”™è¯¯æ¨¡å¼| GraphAnalyzer

    %% æ ·å¼å®šä¹‰
    classDef graphStyle fill:#e8f5e8,stroke:#2e7d32,stroke-width:4px,font-size:18px
    classDef orchestratorStyle fill:#e3f2fd,stroke:#1976d2,stroke-width:3px,font-size:18px
    classDef ledgerStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px,font-size:18px
    classDef analyzerStyle fill:#fff3e0,stroke:#f57c00,stroke-width:2px,font-size:18px
    classDef engineStyle fill:#ffebee,stroke:#c62828,stroke-width:3px,font-size:18px

    class GraphAnalyzer,PathOptimizer graphStyle
    class Orchestrator,ChainSelector,NodeScheduler orchestratorStyle
    class TaskLedger,ProgressLedger ledgerStyle
    class ComplexityAnalyzer,ProgressAnalyzer analyzerStyle
    class DecisionEngine,ErrorHandler engineStyle
```
![alt text](https://typoragraph.oss-cn-beijing.aliyuncs.com/test/202508152258528.png)


**è°ƒåº¦å±‚æ ¸å¿ƒåŠŸèƒ½**ï¼š
- **GraphFlowOrchestrator**ï¼šä¸»æ§åˆ¶å™¨ï¼Œåè°ƒæ•´ä¸ªç³»ç»Ÿçš„æ‰§è¡Œæµç¨‹
- **åŒè´¦æœ¬ç³»ç»Ÿ**ï¼šTaskLedgerç®¡ç†ä»»åŠ¡å±‚é¢ï¼ŒProgressLedgerç®¡ç†æ‰§è¡Œå±‚é¢
- **æ™ºèƒ½åˆ†æ**ï¼šå¤æ‚åº¦åˆ†æå’Œè¿›åº¦åˆ†æï¼Œä¸ºAgent æ‰§è¡Œæä¾›æ›´å‡†ç¡®çš„æŒ‡ä»¤
- **å†³ç­–å¼•æ“**ï¼šåŸºäºåˆ†æç»“æœè¿›è¡Œå†³ç­–å’Œé”™è¯¯å¤„ç†

#### æ‰§è¡Œå±‚ (Execution Layer)

![alt text](https://typoragraph.oss-cn-beijing.aliyuncs.com/test/202508152301657.png)

**æ‰§è¡Œå±‚æ ¸å¿ƒåŠŸèƒ½**ï¼š
- **Agentåä½œä½“ç³»**ï¼š7ä¸ªä¸“ä¸šAgentæŒ‰èŒè´£åˆ†å·¥åä½œ
- **æ‰§è¡Œå¼•æ“**ï¼šåŸºäºAutoGençš„Agentè¿è¡Œæ—¶å’Œé“¾è·¯å·¥å‚
- **é€šä¿¡åè°ƒ**ï¼šAgentCommunicationMemory + ç¼–æ’å™¨é©±åŠ¨çš„è´¦æœ¬åŒæ­¥ï¼ˆProgress/Task Ledgerï¼‰

#### MCPæœåŠ¡å±‚å’Œå­˜å‚¨å±‚

```mermaid
graph TB
    subgraph "MCPæœåŠ¡å±‚ (MCP Service Layer)"
        subgraph "æ–‡ä»¶ç³»ç»ŸæœåŠ¡"
            FileSystemMCP[ğŸ“‚ filesystem-mcp-server<br/>â€¢ æ–‡ä»¶è¯»å†™æ“ä½œ<br/>â€¢ ç›®å½•ç®¡ç†<br/>â€¢ æƒé™æ§åˆ¶<br/>â€¢ è·¯å¾„è§£æ]
        end

        subgraph "ä»£ç æ‰§è¡ŒæœåŠ¡"
            CodeRunnerMCP[â–¶ï¸ code-runner-mcp<br/>â€¢ Pythonä»£ç æ‰§è¡Œ<br/>â€¢ æµ‹è¯•è¿è¡Œ<br/>â€¢ ç»“æœæ•è·<br/>â€¢ é”™è¯¯å¤„ç†]
        end

        subgraph "ä»£ç åˆ†ææœåŠ¡"
            CodeScannerMCP[ğŸ” code-scanner-mcp<br/>â€¢ é™æ€ä»£ç åˆ†æ<br/>â€¢ å¤æ‚åº¦è®¡ç®—<br/>â€¢ å®‰å…¨æ‰«æ<br/>â€¢ è´¨é‡è¯„ä¼°]
        end

        subgraph "ç½‘ç»œæœåŠ¡"
            FetchMCP[ğŸŒ fetch-mcp<br/>â€¢ HTTPè¯·æ±‚<br/>â€¢ APIè°ƒç”¨<br/>â€¢ æ•°æ®è·å–<br/>â€¢ å¤–éƒ¨é›†æˆ]
        end

        subgraph "MCPåè®®å±‚"
            MCPProtocol[ğŸ”— MCP Protocol<br/>â€¢ æ ‡å‡†åŒ–æ¥å£<br/>â€¢ æ¶ˆæ¯ä¼ é€’<br/>â€¢ æœåŠ¡å‘ç°<br/>â€¢ é”™è¯¯å¤„ç†]
        end
    end

    subgraph "å­˜å‚¨å±‚ (Storage Layer)"
        subgraph "å‘é‡åŒ–è®°å¿†ç³»ç»Ÿ"
            ChromaDB[(ğŸ—„ï¸ ChromaDBå‘é‡æ•°æ®åº“<br/>â€¢ è¯­ä¹‰æœç´¢<br/>â€¢ å‘é‡å­˜å‚¨<br/>â€¢ ç›¸ä¼¼åº¦è®¡ç®—<br/>â€¢ æŒä¹…åŒ–å­˜å‚¨)]

            subgraph "è®°å¿†ç®¡ç†å™¨"
                ExecutionMemory[ğŸ“ ExecutionLogManager<br/>â€¢ æ‰§è¡Œæ—¥å¿—å­˜å‚¨<br/>]

                CommMemory[ğŸ’¬ CommunicationMemory<br/>â€¢ Agenté€šä¿¡è®°å½•<br/>â€¢ ä¸Šä¸‹æ–‡å…±äº«<br/>â€¢ åä½œå†å²<br/>â€¢ çŸ¥è¯†ä¼ é€’]

                TestMemory[ğŸ§ª UnitTestMemory<br/>â€¢ æµ‹è¯•ç»“æœå­˜å‚¨<br/>â€¢ å¤±è´¥æ¨¡å¼åˆ†æ<br/>â€¢ æµ‹è¯•ä¼˜åŒ–<br/>]
            end
        end

        subgraph "æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨"
            ProjectFiles[ğŸ“ é¡¹ç›®æ–‡ä»¶ç³»ç»Ÿ<br/>â€¢ æºä»£ç æ–‡ä»¶<br/>â€¢ é…ç½®æ–‡ä»¶<br/>â€¢ æ–‡æ¡£èµ„æº<br/>â€¢ æ„å»ºäº§ç‰©]

            StateFiles[ğŸ’¾ çŠ¶æ€æ–‡ä»¶<br/>â€¢ AgentçŠ¶æ€<br/>â€¢ æ‰§è¡Œå¿«ç…§<br/>â€¢ é…ç½®å¤‡ä»½<br/>]

            ResultFiles[ğŸ“Š ç»“æœæ–‡ä»¶<br/>â€¢ æµ‹è¯•æŠ¥å‘Š<br/>â€¢ æ‰«æç»“æœ<br/>â€¢ æ€§èƒ½æ•°æ®<br/>â€¢ è´¨é‡æŒ‡æ ‡]
        end

        subgraph "é…ç½®ç®¡ç†"
            ConfigManager[âš™ï¸ é…ç½®ç®¡ç†å™¨<br/>â€¢ ç¯å¢ƒé…ç½®<br/>â€¢ æ¨¡å‹é…ç½®<br/>â€¢ MCPé…ç½®<br/>â€¢ é“¾è·¯é…ç½®]
        end
    end

    %% MCPæœåŠ¡å†…éƒ¨è¿æ¥
    FileSystemMCP --> MCPProtocol
    CodeRunnerMCP --> MCPProtocol
    CodeScannerMCP --> MCPProtocol
    FetchMCP --> MCPProtocol

    %% å­˜å‚¨å±‚å†…éƒ¨è¿æ¥
    ExecutionMemory --> ChromaDB
    CommMemory --> ChromaDB
    TestMemory --> ChromaDB

    %% é…ç½®ç®¡ç†å†…éƒ¨è¿æ¥
    ConfigManager --> ProjectFiles
    ConfigManager --> StateFiles
    ConfigManager --> ResultFiles

    %% æ ·å¼
    classDef mcpStyle fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef protocolStyle fill:#e3f2fd,stroke:#1976d2,stroke-width:3px
    classDef vectorStyle fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef memoryStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef fileStyle fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef configStyle fill:#e0f2f1,stroke:#00695c,stroke-width:2px

    class FileSystemMCP,CodeRunnerMCP,CodeScannerMCP,FetchMCP mcpStyle
    class MCPProtocol protocolStyle
    class ChromaDB vectorStyle
    class ExecutionMemory,CommMemory,TestMemory memoryStyle
    class ProjectFiles,StateFiles,ResultFiles fileStyle
    class ConfigManager configStyle
```

**MCPæœåŠ¡å±‚æ ¸å¿ƒåŠŸèƒ½**ï¼š
- **æ ‡å‡†åŒ–æ¥å£**ï¼šåŸºäºMCPåè®®çš„ç»Ÿä¸€æœåŠ¡æ¥å£
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šå¯æ’æ‹”çš„æœåŠ¡æ¶æ„ï¼Œæ”¯æŒåŠ¨æ€æ‰©å±•
- **å®‰å…¨éš”ç¦»**ï¼šæ¯ä¸ªæœåŠ¡åœ¨ç‹¬ç«‹ç¯å¢ƒä¸­è¿è¡Œ
- **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯æ£€æµ‹å’Œæ¢å¤æœºåˆ¶

**å­˜å‚¨å±‚æ ¸å¿ƒåŠŸèƒ½**ï¼š
- **å‘é‡åŒ–è®°å¿†**ï¼šåŸºäºChromaDBçš„è¯­ä¹‰æœç´¢å’ŒçŸ¥è¯†å­˜å‚¨
- **å¤šç»´åº¦è®°å¿†ç®¡ç†**ï¼šæ‰§è¡Œè®°å¿†ã€é€šä¿¡è®°å¿†ã€æµ‹è¯•è®°å¿†
- **æ–‡ä»¶ç³»ç»Ÿç®¡ç†**ï¼šé¡¹ç›®æ–‡ä»¶ã€çŠ¶æ€æ–‡ä»¶ã€ç»“æœæ–‡ä»¶çš„åˆ†ç±»å­˜å‚¨
- **é…ç½®ç®¡ç†**ï¼šç»Ÿä¸€çš„é…ç½®ç®¡ç†å’Œç¯å¢ƒæ§åˆ¶

## ä¸»è¦å·¥ä½œå†…å®¹

### 1. ç³»ç»Ÿæ¶æ„è®¾è®¡

#### å¤šAgentåä½œç³»ç»Ÿ
- **åŸºäºAutoGenæ¡†æ¶**ï¼šç»“åˆGraphFlowç»“æ„åŒ–æ‰§è¡Œå’ŒMagenticOneåŒè´¦æœ¬é£æ ¼è°ƒåº¦
- **7ä¸ªä¸“ä¸šAgent**ï¼šæ¯ä¸ªAgentå…·æœ‰æ˜ç¡®çš„èŒè´£åˆ†å·¥å’Œä¸“ä¸šå·¥å…·é›†æˆ
- **èŠ‚ç‚¹é€‰æ‹©**ï¼šåŸºäºè¿›åº¦è´¦æœ¬(ProgressLedger)åˆ†æçš„è°ƒåº¦
- **å¼‚æ­¥æ‰§è¡Œæµç¨‹**ï¼šæ”¯æŒAgenté—´çš„åè°ƒå’ŒçŠ¶æ€åŒæ­¥

#### MCPæœåŠ¡é›†æˆ
- **filesystem-mcp-server**ï¼šæä¾›å®Œæ•´çš„æ–‡ä»¶ç³»ç»Ÿæ“ä½œèƒ½åŠ›
- **code-runner-mcp**ï¼šæ”¯æŒä»£ç æ‰§è¡Œå’Œæµ‹è¯•è¿è¡Œ
- **code-scanner-mcp**ï¼šé™æ€ä»£ç åˆ†æå’Œè´¨é‡æ£€æµ‹
- **fetch-mcp**ï¼šå¤–éƒ¨APIè°ƒç”¨å’Œæ•°æ®è·å–

#### ä¸‰å±‚æ¶æ„
- **è°ƒåº¦å±‚**ï¼šGraphFlowOrchestratoræ ¸å¿ƒç¼–æ’å™¨
- **æ‰§è¡Œå±‚**ï¼šåŸºäºAutoGençš„Agentæ‰§è¡Œå¼•æ“
- **å­˜å‚¨å±‚**ï¼šåŸºäºChromaDBçš„å‘é‡åŒ–å†…å­˜ç®¡ç†

### 2. å¤šAgentç³»ç»Ÿå¼€å‘

#### Agentåä½œä½“ç³»

```mermaid
graph LR
    A[CodePlanningAgent<br/>éœ€æ±‚åˆ†æä¸è§„åˆ’] --> B[FunctionWritingAgent<br/>ä»£ç å®ç°]
    B --> C[TestGenerationAgent<br/>æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆ]
    C --> D[UnitTestAgent<br/>æµ‹è¯•æ‰§è¡ŒéªŒè¯]

    D -->|<font size=7>æµ‹è¯•å¤±è´¥</font>| E[RefactoringAgent<br/>ä»£ç é‡æ„ä¼˜åŒ–]
    D -->|<font size=7>æµ‹è¯•é€šè¿‡</font>| F[CodeScanningAgent<br/>è´¨é‡æ‰«ææ£€æµ‹]

    E --> F
    F --> G[ProjectStructureAgent<br/>é¡¹ç›®ç»“æ„åŒ–]
    style A fill:#e1f5fe
    style B fill:#f3e5f5
    style C fill:#e8f5e8
    style D fill:#fff3e0
    style E fill:#fce4ec
    style F fill:#f1f8e9
    style G fill:#e0f2f1
    classDef agentStyle fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,font-size:40px
    class A,B,C,D,E,F,G agentStyle

    %% è®¾ç½®ç®­å¤´çº¿æ¡ç²—ç»†å’Œå¤§å°
    linkStyle 0,1,2,3,4,5,6 stroke-width:5px
```

#### ä¸“ä¸šå·¥å…·é›†æˆ
æ¯ä¸ªAgenté…ç½®ä¸“é—¨çš„ç³»ç»Ÿæ¶ˆæ¯å’ŒMCPå·¥å…·é›†æˆï¼š
- **CodePlanningAgent**ï¼šéœ€æ±‚åˆ†æã€æŠ€æœ¯é€‰å‹ã€å®ç°è§„åˆ’ã€‚é…ç½® FileSystem MCPã€‚
- **FunctionWritingAgent**ï¼šPythonå‡½æ•°å®ç°ã€ä»£ç ç”Ÿæˆã€‚é…ç½® FileSystem MCPã€‚
- **TestGenerationAgent**ï¼šæµ‹è¯•ç”¨ä¾‹è®¾è®¡ã€è¾¹ç•Œæ¡ä»¶è¦†ç›–ã€‚é…ç½® FileSystem MCPã€‚
- **UnitTestAgent**ï¼šæµ‹è¯•æ‰§è¡Œã€ç»“æœéªŒè¯ã€é”™è¯¯è¯Šæ–­ã€‚é…ç½® Code-runner MCPã€‚
- **RefactoringAgent**ï¼šä»£ç ä¼˜åŒ–ã€æ€§èƒ½æ”¹è¿›ã€ç»“æ„è°ƒæ•´ã€‚é…ç½® FileSystem MCPã€‚
- **CodeScanningAgent**ï¼šé™æ€åˆ†æã€å®‰å…¨æ£€æµ‹ã€è´¨é‡è¯„ä¼°ã€‚é…ç½®é™æ€æ‰«æMCPã€‚
- **ProjectStructureAgent**ï¼šç›®å½•ç»“æ„ã€æ–‡æ¡£ç”Ÿæˆã€é¡¹ç›®ç»„ç»‡ã€‚é…ç½® FileSystem MCPã€‚

#### ä»»åŠ¡å¤æ‚åº¦åˆ†æ
ä»»åŠ¡è¯„ä¼°æ–¹æ³•ï¼š
- **é™æ€ä»£ç åˆ†æ**ï¼šå‡½æ•°å¤æ‚åº¦ã€ä¾èµ–å…³ç³»ã€ä»£ç è§„æ¨¡
- **LLMè¾…åŠ©è¯„ä¼°**ï¼šè¯­ä¹‰ç†è§£ã€æŠ€æœ¯éš¾åº¦ã€å®ç°å¤æ‚åº¦

### 3. å¤šç§é“¾è·¯

#### å››ç§æ‰§è¡Œé“¾è·¯
<div style="width: 100%; height: 600px;">

```mermaid
graph TD
    subgraph "é“¾è·¯é€‰æ‹©ç­–ç•¥"
        Task[ä»»åŠ¡è¾“å…¥] --> Analyzer[å¤æ‚åº¦åˆ†æå™¨]
        Analyzer --> Decision{å¤æ‚åº¦è¯„ä¼°}

        Decision -->|ç®€å•ä»»åŠ¡| Prototype[åŸå‹é“¾è·¯<br/>2ä¸ªAgent]
        Decision -->|ä¸­ç­‰ä»»åŠ¡| Minimal[æœ€å°é“¾è·¯<br/>4ä¸ªAgent]
        Decision -->|å¤æ‚ä»»åŠ¡| Quality[è´¨é‡é“¾è·¯<br/>6ä¸ªAgent]
        Decision -->|ä¼ä¸šçº§| Standard[æ ‡å‡†é“¾è·¯<br/>7ä¸ªAgent]
    end

    subgraph "åŸå‹é“¾è·¯ (Prototype)"
        P1[CodePlanningAgent] --> P2[FunctionWritingAgent]
    end

    subgraph "æœ€å°é“¾è·¯ (Minimal)"
        M1[CodePlanningAgent] --> M2[FunctionWritingAgent]
        M2 --> M3[TestGenerationAgent]
        M3 --> M4[UnitTestAgent]
    end

    subgraph "è´¨é‡é“¾è·¯ (Quality)"
        Q1[CodePlanningAgent] --> Q2[FunctionWritingAgent]
        Q2 --> Q3[TestGenerationAgent]
        Q3 --> Q4[UnitTestAgent]
        Q4 --> Q5[RefactoringAgent]
        Q5 --> Q6[CodeScanningAgent]
    end

    subgraph "æ ‡å‡†é“¾è·¯ (Standard)"
        S1[CodePlanningAgent] --> S2[FunctionWritingAgent]
        S2 --> S3[TestGenerationAgent]
        S3 --> S4[UnitTestAgent]
        S4 -->|æµ‹è¯•å¤±è´¥| S5[RefactoringAgent]
        S4 -->|æµ‹è¯•é€šè¿‡| S6[CodeScanningAgent]
        S5 --> S6
        S6 --> S7[ProjectStructureAgent]
    end
```

### 4. å‘é‡åŒ–æ•°æ®åº“

#### ChromaDB
- **é‡‡ç”¨æ¨¡å‹**ï¼šä½¿ç”¨paraphrase-multilingual-MiniLM-L12-v2æœ¬åœ°éƒ¨ç½²æ¨¡å‹
- **è¯­ä¹‰æœç´¢èƒ½åŠ›**ï¼šæ”¯æŒä¸­è‹±æ–‡æ··åˆæŸ¥è¯¢

#### è®°å¿†ç®¡ç†
<div style="width: 100%; height: 600px; margin: 20px 0;">

```mermaid
graph TB
    subgraph "è®°å¿†ç³»ç»Ÿæ¶æ„"
        subgraph "æ‰§è¡Œè®°å¿†"
            ExecLog[ExecutionLogManager<br/>â€¢ record_execution<br/>â€¢get_similar_executions<br/>â€¢ get_error_solutions]
        end

        subgraph "çŠ¶æ€è®°å¿†"
            StateManager[AgentStateManager<br/>â€¢ save_agent_state<br/>â€¢ load_agent_state<br/>â€¢ list_saved_states]
        end

        subgraph "é€šä¿¡è®°å¿†"
            CommMemory[AgentCommunicationMemory<br/>â€¢ update_agent_context<br/>â€¢ get_agent_context<br/>â€¢ send_message<br/>â€¢ get_messages_for_agent]
        end

        subgraph "æµ‹è¯•è®°å¿†"
            UnitTestMemory[UnitTestMemoryManager<br/>â€¢ record_complete_test_execution<br/>â€¢ get_test_history<br/>â€¢get_detailed_test_info_for_refactoring]
        end

        subgraph "å­˜å‚¨åç«¯"
            ChromaDB[(ChromaDBå‘é‡æ•°æ®åº“<br/>agent_execution_logs<br/>workflow_patterns)]
            FileSystem[(æ–‡ä»¶ç³»ç»Ÿ<br/>memory/agent_states)]
        end
    end

    
    ExecLog -->|collection: agent_execution_logs| ChromaDB
    CommMemory -->|collection: workflow_patterns| ChromaDB
    UnitTestMemory -->|collection: workflow_patterns| ChromaDB
    StateManager -->|JSON files| FileSystem
    %% æ ·å¼
    classDef execStyle fill:#e3f2fd,stroke:#1976d2,stroke-width:2px,font-size:25px
    classDef stateStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,font-size:25px
    classDef commStyle fill:#e8f5e8,stroke:#388e3c,stroke-width:2px,font-size:25px
    classDef testStyle fill:#fff3e0,stroke:#f57c00,stroke-width:2px,font-size:25px
    classDef storageStyle fill:#fce4ec,stroke:#c2185b,stroke-width:2px,font-size:25px

    class ExecLog execStyle
    class StateManager stateStyle
    class CommMemory commStyle
    class UnitTestMemory testStyle
    class ChromaDB,FileSystem storageStyle
```
## æŠ€æœ¯æ ˆ
- **å¼€å‘è¯­è¨€**ï¼šPython 3.13
- **AIæ¡†æ¶**ï¼šAutoGen AgentChat 0.4.0+
- **åè®®æ ‡å‡†**ï¼šMCP (Model Context Protocol) 1.0+
- **å‘é‡æ•°æ®åº“**ï¼šChromaDB with Sentence Transformers
- **AIæ¨¡å‹**ï¼šæ”¯æŒOpenAIå…¼å®¹APIï¼Œé»˜è®¤ä½¿ç”¨Qwen3-Coder
## é™„å½•

### A. ç³»ç»Ÿæ‰§è¡Œæ—¶åºå›¾

```mermaid
sequenceDiagram
    participant User as ğŸ‘¤ ç”¨æˆ·
    participant Orch as ğŸ® GraphFlowOrchestrator
    participant TL as ğŸ“‹ TaskLedger
    participant PL as ğŸ“ˆ ProgressLedger
    participant CA as ğŸ§  ComplexityAnalyzer
    participant DE as âš¡ DecisionEngine
    participant Agents as ğŸ¤– Agentç³»ç»Ÿ
    participant MCP as ğŸ”Œ MCPæœåŠ¡
    participant Memory as ğŸ’¾ è®°å¿†ç³»ç»Ÿ

    User->>Orch: æäº¤ä»»åŠ¡è¯·æ±‚
    Orch->>TL: åˆå§‹åŒ–ä»»åŠ¡è´¦æœ¬
    Orch->>CA: åˆ†æä»»åŠ¡å¤æ‚åº¦
    CA->>CA: è¯­æ³•/è¯­ä¹‰/ä¾èµ–åˆ†æ
    CA-->>Orch: è¿”å›å¤æ‚åº¦è¯„ä¼°ç»“æœ

    Orch->>DE: è¯·æ±‚é“¾è·¯é€‰æ‹©å†³ç­–
    DE->>DE: åŸºäºå¤æ‚åº¦é€‰æ‹©é“¾è·¯
    DE-->>Orch: è¿”å›æ‰§è¡Œé“¾è·¯é…ç½®

    Orch->>Agents: åˆå§‹åŒ–Agenté“¾è·¯

    loop MagenticOneè°ƒåº¦å¾ªç¯
        Orch->>PL: æ›´æ–°æ‰§è¡Œè¿›åº¦çŠ¶æ€
        Orch->>DE: è¯·æ±‚ä¸‹ä¸€èŠ‚ç‚¹é€‰æ‹©
        DE->>TL: æŸ¥è¯¢ä»»åŠ¡ä¾èµ–å…³ç³»
        DE->>PL: åˆ†æå½“å‰æ‰§è¡ŒçŠ¶æ€
        DE-->>Orch: è¿”å›æœ€ä¼˜èŠ‚ç‚¹é€‰æ‹©

        Orch->>Agents: æ‰§è¡Œé€‰å®šAgentèŠ‚ç‚¹
        Agents->>MCP: è°ƒç”¨ç›¸å…³å·¥å…·æœåŠ¡
        MCP->>MCP: æ‰§è¡Œå…·ä½“æ“ä½œ
        MCP-->>Agents: è¿”å›æ‰§è¡Œç»“æœ

        Agents->>Memory: è®°å½•æ‰§è¡Œæ—¥å¿—å’Œç»éªŒ
        Agents-->>Orch: è¿”å›Agentæ‰§è¡Œç»“æœ

        Orch->>PL: æ›´æ–°èŠ‚ç‚¹æ‰§è¡ŒçŠ¶æ€

        alt æ‰§è¡ŒæˆåŠŸ
            Orch->>TL: æ ‡è®°ä»»åŠ¡èŠ‚ç‚¹å®Œæˆ
            Orch->>PL: æ›´æ–°æˆåŠŸæŒ‡æ ‡
        else æ‰§è¡Œå¤±è´¥
            Orch->>DE: è¯·æ±‚é”™è¯¯æ¢å¤ç­–ç•¥
            DE-->>Orch: è¿”å›æ¢å¤æ–¹æ¡ˆ
            Orch->>Orch: æ‰§è¡Œé”™è¯¯æ¢å¤
        end

        Orch->>Orch: æ£€æŸ¥é“¾è·¯å®ŒæˆçŠ¶æ€
    end

    Orch->>Memory: å­˜å‚¨å®Œæ•´æ‰§è¡Œè®°å½•
    Orch-->>User: è¿”å›æœ€ç»ˆé¡¹ç›®ç»“æœ
```

### B. MCPæœåŠ¡è¯¦ç»†é…ç½®

#### 1. æ–‡ä»¶ç³»ç»ŸMCPæœåŠ¡é…ç½®
```json
{
filesystem_mcp_server = StdioServerParams(
        command="node",
        args=[
            "/Users/jabez/Nutstore Files/multiAgent/mcp_services/filesystem-mcp-server/dist/index.js",
            "/Users"
        ],
        env={
            "FS_BASE_DIRECTORY": "/Users"
        }
    )
```

#### 2. ä»£ç æ‰«æMCPæœåŠ¡é…ç½®
```json
{
  "name": "code-scanner-mcp",
  "version": "0.1.0",
  "scan_types": [
    {
      "name": "complexity",
      "description": "å¤æ‚åº¦åˆ†æï¼šåœˆå¤æ‚åº¦ã€è®¤çŸ¥å¤æ‚åº¦ã€Halsteadå¤æ‚åº¦"
    },
    {
      "name": "style",
      "description": "ä»£ç é£æ ¼æ£€æŸ¥ï¼šPEP8åˆè§„æ€§ã€å‘½åè§„èŒƒã€å¯¼å…¥æ’åº"
    },
    {
      "name": "security",
      "description": "å®‰å…¨æ‰«æï¼šå®‰å…¨æ¼æ´æ£€æµ‹ã€ä¾èµ–å®‰å…¨æ£€æŸ¥"
    },
    {
      "name": "documentation",
      "description": "æ–‡æ¡£è´¨é‡ï¼šæ–‡æ¡£å­—ç¬¦ä¸²æ£€æŸ¥ã€ç±»å‹æ³¨è§£æ£€æŸ¥"
    }
  ],
  "supported_formats": ["json", "markdown", "html"],
  "supported_languages": [".py"]
}
```
#### 3.ä»£ç æ‰§è¡Œ MCP æœåŠ¡é…ç½®
```json
{
  code_runner_mcp_server = StdioServerParams(
        command="npx",
        args=[
            "-y",
            "mcp-server-code-runner@latest"
        ]
    )
}
```
### C. å‘é‡æ•°æ®åº“é…ç½®è¯¦æƒ…

#### ChromaDBé…ç½®å‚æ•°
```python
# æ‰§è¡Œæ—¥å¿—å‘é‡å­˜å‚¨é…ç½®
execution_memory_config = {
    "collection_name": "agent_execution_logs",
    "embedding_model": "paraphrase-multilingual-MiniLM-L12-v2",
    "distance_metric": "cosine",
    "vector_dimension": 384,
    "k": 50,  # è¿”å›æœ€ç›¸å…³çš„50ä¸ªç»“æœ
    "score_threshold": 0.0,  # ä¸è¿‡æ»¤ä»»ä½•ç»“æœ
    "persistence_path": "./memory/execution_logs/"
}

# å·¥ä½œæµæ¨¡å¼å‘é‡å­˜å‚¨é…ç½®
workflow_memory_config = {
    "collection_name": "workflow_patterns",
    "embedding_model": "paraphrase-multilingual-MiniLM-L12-v2",
    "distance_metric": "cosine",
    "vector_dimension": 384,
    "k": 3,  # è¿”å›æœ€ç›¸å…³çš„3ä¸ªå·¥ä½œæµæ¨¡å¼
    "score_threshold": 0.0,
    "persistence_path": "./memory/workflow_patterns/"
}
```
#### åµŒå…¥æ¨¡å‹é€‰æ‹©
| æ¨¡å‹åç§° | ç»´åº¦ | å¤§å° | è¯­è¨€æ”¯æŒ |
|---------|------|------|----------|
| all-MiniLM-L6-v2 | 384 | 22MB | è‹±æ–‡ä¸ºä¸» |
| paraphrase-multilingual-MiniLM-L12-v2 | 384 | 118MB | å¤šè¯­è¨€ |
| all-mpnet-base-v2 | 768 | 420MB | è‹±æ–‡ |

## å­˜åœ¨çš„é—®é¢˜
- é“¾è·¯å†…éƒ¨èŠ‚ç‚¹æ‰§è¡Œä¸»è¦é‡‡ç”¨é¡ºåºæ‰§è¡Œï¼Œç¼ºä¹å¹¶è¡Œæ‰§è¡Œèƒ½åŠ›
- é“¾è·¯é…ç½®ä¸å¤Ÿçµæ´»ï¼Œæ— æ³•æ ¹æ®è¿è¡Œæ—¶åŠ¨æ€è°ƒæ•´
- æœ‰å‘é‡æ•°æ®åº“ï¼Œä½†Agent ç›®å‰ä¸å…·å¤‡ RAG èƒ½åŠ›
- Agent æ‰©å±•æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦ä¿®æ”¹å¤šå¤„ä»£ç 
- ...
